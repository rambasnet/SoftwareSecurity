version: "3.8"

services:
  kali:
    build:
      context: . # Use the current directory (where the Dockerfile is located)
      dockerfile: Kali-Dockerfile # Specify the Dockerfile name if it's not the default Dockerfile
    container_name: kali
    hostname: kali
    tty: true
    cap_add:
      - ALL
    privileged: true
    volumes:
      - ./volumes:/volumes
    networks:
      pentest:
        ipv4_address: 192.168.10.100

  target:
    image: tleemcjr/metasploitable2
    container_name: metasploitable2
    hostname: metasploitable2
    tty: true
    cap_add:
      - ALL
    networks:
      pentest:
        ipv4_address: 192.168.10.200

  nessus:
    #build:
    #  context: . # Use the current directory (where the Dockerfile is located)
    #  dockerfile: nessus-Dockerfile # Specify the Dockerfile name if it's not the default Dockerfile
    image: tenableofficial/nessus
    container_name: nessus
    restart: always
    ports:
      - "8834:8834" # Web UI and API
    volumes:
      #- ./nessus_data:/opt/nessus/var/nessus
      - ./nessus_config:/opt/nessus/etc/nessus
    networks:
      pentest:
        ipv4_address: 192.168.10.10
    #environment:
    #  - USERNAME="admin" # Set admin username
    #  - PASSWORD="admin" # FIXME
    #  - ACTIVATION_CODE="3F2R-NYVJ-X3G6-C84Q-ERLP"

networks:
  pentest:
    name: pentest
    ipam:
      config:
        - subnet: 192.168.10.0/24
